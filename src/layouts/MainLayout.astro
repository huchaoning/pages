---
import "../styles/global.css";
import { Icon } from "astro-icon/components";

const { title = "Chao-Ning Hu" } = Astro.props;
const NAME = "Chao-Ning Hu";

// export const slateLinear =
//   "inline-block bg-linear-to-br from-slate-950 to-slate-600 bg-clip-text text-transparent";
// const hoverSlateLinear =
//   "inline-block hover:bg-linear-to-br hover:from-slate-950 hover:to-slate-600 hover:bg-clip-text hover:text-transparent";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
  </head>

  <body
    class="bg-white text-main font-sans antialiased selection:bg-[#01386a] selection:text-white"
  >
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none"></div>
  </body>

  <nav
    id="main-nav"
    class="fixed top-6 inset-x-0 z-50 flex justify-center px-6 transition-all duration-500 ease-in-out"
  >
    <div
      class="flex items-center justify-between w-full max-w-2xl px-6 py-3 rounded-full glass"
    >
      <a
        href="/"
        class="transition-opacity duration-150 font-bold text-sm hover:opacity-60 text-main"
      >
        {NAME}
      </a>

      <div
        class="flex gap-4 text-[10px] font-black uppercase tracking-widest text-sec"
      >
        <a href="/about" class="hover:text-main duration-150 transition-color"
          >about</a
        >
        <a href="/posts" class="hover:text-main duration-150 transition-color"
          >posts</a
        >
      </div>
    </div>
    <button
      id="search-button"
      class="group flex items-center justify-between px-3 py-3 ml-3 rounded-full duration-150 transition-color hover:bg-ter/50 glass"
      aria-label="Search"
    >
      <Icon
        name="ri:search-line"
        class="w-4.5 h-4.5 text-sec transition-colors duration-150 group-hover:text-main"
      />
    </button>
  </nav>

  <slot />
</html>

<style is:global>
  .nav-hidden {
    transform: translateY(-200%) scale(0.9);
    pointer-events: none;
  }
</style>

<script>
  // @ts-nocheck
  let lastScrollY = window.scrollY;
  let scrollUpAmount = 0;
  const nav = document.getElementById("main-nav");
  const threshold = 60;

  window.addEventListener(
    "scroll",
    () => {
      const currentScrollY = window.scrollY;

      if (currentScrollY <= 0) {
        nav.classList.remove("nav-hidden");
        lastScrollY = 0;
        scrollUpAmount = 0;
        return;
      }

      const maxScroll =
        document.documentElement.scrollHeight - window.innerHeight;
      if (currentScrollY >= maxScroll) {
        lastScrollY = currentScrollY;
        return;
      }

      const diff = lastScrollY - currentScrollY;

      if (currentScrollY > lastScrollY) {
        scrollUpAmount = 0;
        if (currentScrollY > 100) {
          nav.classList.add("nav-hidden");
        }
      } else {
        scrollUpAmount += diff;
        if (scrollUpAmount > threshold || currentScrollY < 10) {
          nav.classList.remove("nav-hidden");
        }
      }

      lastScrollY = currentScrollY;
    },
    { passive: true },
  );
</script>
